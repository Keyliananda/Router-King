# RouterKing Test-Workflow: DXF ‚Üí G-Code ‚Üí GRBL

**Datum:** 2026-01-17  
**Ziel:** Kompletter Test des CAM-Workflows

---

## Test-Projekt: Einfaches Quadrat

**Datei:** `tests/test-square.dxf`

**Beschreibung:**
- 50x50mm Quadrat
- Position: (10, 10) bis (60, 60)
- Geschlossene Kontur
- Ideal f√ºr Profile-Operation

---

## Schritt-f√ºr-Schritt Anleitung

### Schritt 1: FreeCAD √∂ffnen

1. FreeCAD starten
2. Neues Dokument: `File ‚Üí New` (oder Cmd+N)

---

### Schritt 2: DXF importieren

```
File ‚Üí Open ‚Üí tests/test-square.dxf
```

**Was passiert:**
- FreeCAD √∂ffnet die DXF-Datei
- Im Model-Tree siehst du: "test-square" mit Objekten

**Wichtig:** 
- Das DXF wird als 2D-Geometrie importiert
- Im 3D-View solltest du ein Quadrat sehen

---

### Schritt 3: CAM Workbench aktivieren

**Workbench-Dropdown (oben):**
```
[Dropdown ‚ñº] ‚Üí "CAM" ausw√§hlen
```

**Was sich √§ndert:**
- Neue Toolbar erscheint (CAM-Icons)
- Men√º "CAM" wird sichtbar

---

### Schritt 4: Job erstellen

**Men√º:**
```
CAM ‚Üí Job ‚Üí Job
```

**Oder Toolbar:** Klick auf "Job" Icon (Ordner-Symbol)

**Job-Dialog √∂ffnet sich:**

#### 4.1 Setup Tab

**Model:**
```
[Select...] ‚Üí Klick auf dein importiertes Quadrat im Tree
```

**Template:** 
```
Leave as "None"
```

**PostProcessor:**
```
[Dropdown] ‚Üí "refactored_grbl" ausw√§hlen
```

**Output File:**
```
[Browse...] ‚Üí /Users/kilianvolz/Code/Router-King/tests/test-output.nc
```

#### 4.2 Stock Tab

**Create Box:**
```
‚úì Enabled
```

**Extent:**
```
Model Base Bounding Box
```

**Extra Offset:**
```
X: 5.0 mm
Y: 5.0 mm
Z: 5.0 mm (H√∂he des Materials)
```

**Placement:**
```
Base: (0, 0, 0)
```

#### 4.3 Tools Tab

**Klick auf [Create Tool]**

**Tool Editor √∂ffnet sich:**
```
Name:           6mm Endmill
Type:           EndMill
Material:       HSS (High Speed Steel)
Diameter:       6.0 mm
Length:         50.0 mm
Flutes:         2
Cutting Edge:   50.0 mm
```

**[OK]** klicken

**Dann [Add Tool to Job]**

#### 4.4 Workplan Tab

**Noch leer - hier kommen gleich die Operations rein**

**[OK]** klicken um Job zu erstellen

---

### Schritt 5: Profile Operation erstellen

**Men√º:**
```
CAM ‚Üí Profile
```

**Oder Toolbar:** "Profile" Icon

**Profile-Dialog √∂ffnet sich:**

#### 5.1 Base Geometry Tab

**Klick auf [Add Edge]**

**Dann im 3D-View:**
- Klick auf die Kanten des Quadrats (alle 4 Kanten)
- Oder: Klick auf das Face (Fl√§che) des Quadrats

**Base Geometry List sollte zeigen:**
```
‚úì Edge1
‚úì Edge2
‚úì Edge3
‚úì Edge4
```

#### 5.2 Depths Tab

**Start Depth:**
```
0.0 mm (Oberfl√§che)
```

**Final Depth:**
```
-3.0 mm (3mm tief schneiden)
```

**Step Down:**
```
1.0 mm (1mm pro Pass, also 3 P√§sse)
```

#### 5.3 Heights Tab

**Safe Height:**
```
5.0 mm (sicherer Abstand √ºber Material)
```

**Clearance Height:**
```
3.0 mm
```

#### 5.4 Operation Tab

**Side:**
```
‚óã Inside
‚óè Outside  ‚Üê W√§hle "Outside" (schneidet au√üen rum)
‚óã On
```

**Direction:**
```
‚óè CW (Clockwise)
‚óã CCW (Counter-Clockwise)
```

**Use Compensation:**
```
‚òê (erstmal deaktiviert f√ºr Test)
```

#### 5.5 Speeds Tab

**Horizontal Feed:**
```
1200 mm/min
```

**Vertical Feed (Plunge):**
```
300 mm/min
```

**Spindle Speed:**
```
18000 RPM
```

**[OK]** klicken

---

### Schritt 6: Toolpath berechnen

**Im Model-Tree:**
```
Job
  ‚îî‚îÄ Operations
      ‚îî‚îÄ Profile
```

**Rechtsklick auf "Profile" ‚Üí Recompute**

**Was passiert:**
- FreeCAD berechnet den Toolpath
- Im 3D-View siehst du jetzt gr√ºne/rote Linien (der Toolpath)
- Gr√ºn = Cutting Moves (G1)
- Rot = Rapid Moves (G0)

**Pr√ºfe visuell:**
- F√§hrt der Fr√§ser au√üen um das Quadrat?
- Sind 3 P√§sse sichtbar (bei -1mm, -2mm, -3mm)?

---

### Schritt 7: G-Code exportieren

**Rechtsklick auf "Job" ‚Üí Post Process**

**Post Process Dialog:**
```
Output File: /Users/kilianvolz/Code/Router-King/tests/test-output.nc
Post Processor: refactored_grbl
Arguments: (leer lassen)
```

**[OK]** klicken

**Ergebnis:**
- G-Code wird als `test-output.nc` gespeichert
- FreeCAD zeigt eine Vorschau im Output-Fenster

---

### Schritt 8: G-Code pr√ºfen

**√ñffne die Datei:**
```
/Users/kilianvolz/Code/Router-King/tests/test-output.nc
```

**Erwarteter Inhalt (vereinfacht):**
```gcode
(Generated by FreeCAD)
(Post Processor: refactored_grbl)
G21 (Millimeters)
G90 (Absolute)
G17 (XY Plane)

(Begin operation: Profile)
M3 S18000 (Spindle On, 18000 RPM)
G0 Z5.000 (Safe Height)
G0 X13.000 Y7.000 (Rapid to start)

(Pass 1: -1.0mm)
G1 Z-1.000 F300 (Plunge)
G1 X63.000 Y7.000 F1200 (Cut)
G1 X63.000 Y63.000
G1 X7.000 Y63.000
G1 X7.000 Y7.000
G1 X13.000 Y7.000

(Pass 2: -2.0mm)
G1 Z-2.000 F300
G1 X63.000 Y7.000 F1200
...

(Pass 3: -3.0mm)
G1 Z-3.000 F300
...

G0 Z5.000 (Retract)
M5 (Spindle Off)
M2 (End Program)
```

---

### Schritt 9: In RouterKing laden

**Wechsel zu RouterKing Workbench:**
```
[Workbench Dropdown] ‚Üí "RouterKing"
```

**RouterKing Panel √∂ffnen:**
```
Toolbar ‚Üí "RouterKing Panel" Icon
```

**Im Panel:**

#### 9.1 Tab "G-Code" w√§hlen

#### 9.2 G-Code laden
```
[Load] Button klicken
‚Üí tests/test-output.nc ausw√§hlen
‚Üí [Open]
```

**Ergebnis:**
- G-Code erscheint im Editor
- Preview zeigt die Toolpaths (2D)

#### 9.3 Preview pr√ºfen
```
[Preview] Button klicken
```

**Was du sehen solltest:**
- Blaue Linien = Cutting Moves
- Graue Linien = Rapids
- Quadrat-Form erkennbar

---

### Schritt 10: Mit GRBL verbinden

**Tab "Control" w√§hlen**

#### 10.1 Port ausw√§hlen
```
[Port Dropdown] ‚Üí /dev/cu.usbserial-XXXX
```

**Oder:**
```
[Auto] Button ‚Üí RouterKing findet GRBL automatisch
```

#### 10.2 Verbinden
```
[Connect] Button
```

**Status sollte zeigen:**
```
Connection: connected (/dev/cu.usbserial-XXXX)
Machine: Idle | Pos: 0.000,0.000,0.000
```

---

### Schritt 11: Maschine vorbereiten

**WICHTIG - Sicherheit:**
- [ ] Werkst√ºck ist befestigt
- [ ] Fr√§ser ist eingespannt (6mm Endmill)
- [ ] Spindel ist frei
- [ ] Notaus ist erreichbar

#### 11.1 Homing
```
[Home] Button
```

**Maschine f√§hrt zu Limit Switches**

#### 11.2 Position setzen

**Jog-Steuerung nutzen:**
```
Step: 10.0 mm
Feed: 600 mm/min

[X+] [X-] [Y+] [Y-] [Z+] [Z-]
```

**Fahre zu Start-Position:**
- X/Y: Wo das Quadrat gefr√§st werden soll
- Z: √úber dem Material

**Nullpunkt setzen:**
```
Console ‚Üí Eingabe: G10 L20 P0 X0 Y0 Z0
[Send]
```

**Oder √ºber GRBL-Befehle:**
```
G92 X0 Y0 Z0
```

---

### Schritt 12: Testlauf (Dry Run)

**EMPFOHLEN vor echtem Schnitt:**

#### Option A: Spindle Off Test
```
Console ‚Üí M5 (Spindle aus)
```

**Dann Tab "G-Code":**
```
[Start] Button
```

**Maschine f√§hrt den Toolpath ab OHNE zu schneiden**

#### Option B: Z-Offset Test
```
Console ‚Üí G92 Z10.0 (10mm √ºber Material simulieren)
```

**Dann:**
```
[Start] Button
```

**Maschine f√§hrt 10mm √ºber Material**

---

### Schritt 13: Echter Schnitt

**NUR wenn Testlauf OK war!**

#### 13.1 Nullpunkt final setzen
```
Jog zu korrekter Z-Position (auf Material)
Console ‚Üí G92 Z0
```

#### 13.2 Spindel einschalten
```
Console ‚Üí M3 S18000
[Send]
```

**Warte 2-3 Sekunden (Spindel auf Drehzahl)**

#### 13.3 Job starten
```
Tab "G-Code"
[Start] Button
```

**Was passiert:**
- RouterKing streamt G-Code zu GRBL
- Status zeigt: "Job: 1/150 (running)"
- Maschine fr√§st das Quadrat

**W√§hrend des Jobs:**
- [Pause] = Feed Hold (!)
- [Resume] = Cycle Start (~)
- [Stop] = Soft Reset (Ctrl+X)

---

### Schritt 14: Nach dem Job

**Wenn fertig:**
```
Status: "Job: 150/150 (idle)"
```

**Spindel aus:**
```
Console ‚Üí M5
```

**Zu Safe Position fahren:**
```
Console ‚Üí G0 Z10
Console ‚Üí G0 X0 Y0
```

---

## Erwartetes Ergebnis

**Gefr√§stes Teil:**
- 50x50mm Quadrat
- 3mm tief
- Au√üenkontur geschnitten
- Saubere Kanten

---

## Troubleshooting

### Problem: DXF Import zeigt nichts

**L√∂sung:**
```
Import ‚Üí Import DXF (statt File ‚Üí Open)
```

### Problem: "No valid geometry selected"

**L√∂sung:**
- Im CAM Profile: Kanten einzeln anklicken
- Oder: Face (Fl√§che) anklicken

### Problem: Toolpath berechnet nicht

**L√∂sung:**
- Job ‚Üí Recompute
- Profile ‚Üí Recompute
- FreeCAD neu starten

### Problem: Post Process schreibt keine Datei

**L√∂sung:**
- Output Path pr√ºfen (Schreibrechte?)
- Manuell: Job ‚Üí Export ‚Üí G-Code

### Problem: RouterKing zeigt G-Code nicht

**L√∂sung:**
- Datei-Endung pr√ºfen (.nc, .gcode)
- Manuell √∂ffnen und Copy-Paste in Editor

### Problem: GRBL Alarm beim Start

**L√∂sung:**
```
[Unlock] Button
[Home] Button
```

### Problem: Fr√§ser f√§hrt falsche Richtung

**L√∂sung:**
- Profile ‚Üí Operation ‚Üí Direction: CW ‚Üî CCW wechseln
- Oder: Side: Inside ‚Üî Outside wechseln

---

## N√§chste Test-Projekte

### Test 2: Pocket (Tasche)
- Quadrat mit Tasche innen
- Pocket Operation

### Test 3: Drilling (Bohren)
- 4 L√∂cher an Ecken
- Drilling Operation

### Test 4: Komplexe DXF
- Text oder Logo
- Multi-Contour

---

## Checkliste

**Vor dem Start:**
- [ ] Test-DXF erstellt (`tests/test-square.dxf`)
- [ ] FreeCAD ge√∂ffnet
- [ ] CAM Workbench verf√ºgbar

**CAM Setup:**
- [ ] DXF importiert
- [ ] Job erstellt (Post: refactored_grbl)
- [ ] Tool definiert (6mm Endmill)
- [ ] Profile Operation erstellt
- [ ] Toolpath berechnet (gr√ºne Linien sichtbar)
- [ ] G-Code exportiert (`test-output.nc`)

**RouterKing:**
- [ ] Workbench gewechselt
- [ ] G-Code geladen
- [ ] Preview gepr√ºft
- [ ] Mit GRBL verbunden
- [ ] Maschine gehomed

**Sicherheit:**
- [ ] Werkst√ºck befestigt
- [ ] Fr√§ser eingespannt
- [ ] Notaus erreichbar
- [ ] Dry Run durchgef√ºhrt

**Job:**
- [ ] Nullpunkt gesetzt
- [ ] Spindel an
- [ ] Job gestartet
- [ ] Job erfolgreich

---

**Viel Erfolg beim Test!** üéØ

**Bei Problemen:** Screenshot + Fehlermeldung ‚Üí dann debuggen wir!
